!function e(r,i,t){function n(a,s){if(!i[a]){if(!r[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var l=i[a]={exports:{}};r[a][0].call(l.exports,function(e){var i=r[a][1][e];return n(i?i:e)},l,l.exports,e,r,i,t)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<t.length;a++)n(t[a]);return n}({1:[function(e){(function(e){YUI.add("flickr-router",function(r){"use strict";var i,t,n;n="scrolling",r.FlickrRouter=function(e,r){return this.app=e,YUI.Env.isServer?(this.route=e.get.bind(e),this.render=i.server.bind(this)):(this.route=e.route.bind(e),this.render=i.client.bind(this)),this.setupRoutes(r),this},r.FlickrRouter.prototype={setupRoutes:function(e){var r,i,t,n,o;for(t in e.patterns)this.registerParam(t,new RegExp(e.patterns[t]));for(r=0;r<e.routes.length;r++)if(n=e.routes[r],n.path instanceof Array)for(i=0;i<n.path.length;i++){o={};for(t in n)"path"!==t&&(o[t]=n[t]);o.path=n.path[i],this.registerRoute(o)}else this.registerRoute(n)},registerParam:function(e,r){YUI.Env.isServer?this.app.param(e,function(e,i,t,n,o){var a=r.exec(n);a?(e.params[o]=a[0],t()):t("route")}):this.app.param(e,r)},registerRoute:function(e){var i=this;this.route(e.path,function(e,i,t){!YUI.Env.isServer&&r.Flog&&r.Flog.time("[Routing to Activation]"),t()},function(e,r,i){!YUI.Env.isServer&&"appContext"in window&&(e.appContext=window.appContext),i()},r.Middleware.MobileRedirect(e),r.Middleware.NormalizeParamsHash(),r.Middleware.NormalizeParam("nsid_or_path_alias"),r.Middleware.NormalizePathParams(),r.Middleware.SetRouteConfig(e),function(r,n,o){return t.bounceRoute(r,n,o,e,i)},function(r,i,n){return t.checkOptIn(r,i,n,e)},function(r,i,n){return t.checkAndKick(r,i,n,e)},function(r,i,n){return t.mixInServerRequest(r,i,n,e)},function(r,n,o){return t.checkAndInterstitial(r,n,o,e,i)},function(r,t,n){i._processRequest(e,r,t,n)})},_processRequest:function(i,t,n,o){var a=this;t.transactionId=r.guid(),this.currentTransactionId=t.transactionId,t.appContext.startTime=Date.now(),t.appContext.getRoute(i.module).then(function(o){var s,c;return a.executingRoute=o,s=YUI.Env.isServer&&!i.skipAuth?YUI.Env.server.siteAuth.authenticate(t,n):r.when(null),c={id:t.id,isInsecureGod:t.isInsecureGod,cookies:t.cookies,headers:t.headers,params:t.params,url:t.url.toString(),query:t.query,buckets:t.buckets,lang:t.lang,probableUser:t.probableUser,UA:t.UA},t.isGod&&(c.isGod=t.isGod),YUI.Env.isServer&&YUI.Env.config.debug_request_timing&&(t.latencyTimerRouteStart=e.hrtime()),t.routeTimingStart=Date.now(),r.Promise.all([s,o.run(c,n)])}).then(function(i){return i.length>=2&&(t.appContext.initialView=i[1].view),i[1].isMobile?(r.Flog.debug("[flickr-router] route is being processed as mobile."),i[1].params||(i[1].params={}),i[1].params.isMobile=!0):r.Flog.debug("[flickr-router] route is being processed as desktop."),YUI.Env.isServer&&YUI.Env.config.debug_request_timing&&(t.latencyTimerViewStart=e.hrtime()),YUI.Env.isServer&&t.appContext&&t.appContext.flipper.isFlipped("enable-bots-server-rendering")&&(t.appContext.forceServerRender=t.appContext._doForcedServerRender()),a._renderView(i,t,n,o)}).then(null,function(e){return a._throwError.call(a,e,t,n,o)})},_renderView:function(i,t,o){var a,s=i.length>0?i[0]:null,c=i.length>1?i[1]:null;if(!c)throw new Error("Invalid viewConfig");if(s){if(s.signedIn&&s.user&&s.user.username?r.Flog.debug("[site auth]","["+s.user.nsid+"]",s.user.username._content+" is signed in."):r.Flog.debug("[site auth] user is signed out."),s.signedIn&&s.user)for(a in s.user)"undefined"==typeof YUI.Env.config.auth.whitelisted_keys[a]&&delete s.user[a];s.isInsecureGod=t.isInsecureGod,t.appContext.auth=s,t.appContext.initCuratorTools()}return c&&"undefined"!=typeof c.params&&(c.params.isOwner=YUI.Env.isServer?s&&s.signedIn&&s.user&&s.user.nsid===c.params.nsid:t.appContext.getViewer().signedIn&&t.appContext.getViewer().nsid===c.params.nsid),c.redirect?this.render(t,o,c):(c.layout=c.layout||n,c.title=r.pageTitleHelper(c.title),YUI.Env.isServer&&YUI.Env.config.debug_request_timing&&(t.latencyTimerRenderStart=e.hrtime()),t.appContext.routeTiming=Date.now()-t.routeTimingStart,this.render(t,o,c))},_throwError:function(e,i,t,n){var o,a,s=i&&i.UA&&(i.UA.isBot||i.UA.isSharingBot),c=s?r.fletrics.getBotString():"",p=this;if(t.headersSent)return r.Flog.debug("[flickr-router]","server render called but headers have already been sent","timeout="+(i.timeout?1:0)),void 0;try{if(YUI.Env.isServer&&"SiteAuth"===e.type?(r.fletrics.increment("siteauth.failures"),e.timeout&&r.fletrics.increment("api.timeouts"),e.failure&&r.fletrics.increment("api.other"),r.Flog.error("[site auth]",e.message)):(r.fletrics.increment("page.failures"+c),r.Flog.error("[router] Reboot page failure",e.message,i.url),e.fatal?e.timeout||e.clientTimeout?(r.fletrics.increment("api.timeouts"+c),r.Flog.error("Unexpected error: api.timeouts"+c+" | Error: ",e.message)):(r.fletrics.increment("api.other"+c),r.Flog.error("Unexpected error: api.other"+c+" | Error: ",e.message)):(r.fletrics.increment("page.failures.other"+c),r.Flog.error("Unexpected error: page.failures.other | Error: ",e.message+" | isBot: "+s),r.config.win&&r.config.win.beaconError&&r.config.win.beaconError("[flickr-router] Unexpected page failure:"+e.message+" UA:"+(navigator&&navigator.userAgent||"").toString(),r.config.win.location.href,e))),r.config.win&&r.config.win.beaconError){e.panda=!0;var l="";i&&i.UA&&(l=" unsupported:"+i.UA.isUnsupportedBrowser+" ");var u=["undefined","Script error.","Script error","XHR error"];navigator.userAgent&&(void 0===typeof e.message||u.indexOf(e.message)>-1)&&(e.message=(e.message||"")+(navigator&&navigator.userAgent||"").toString()),r.config.win.beaconError("[flickr-router]"+l+e.message,r.config.win.location.href,e)}}catch(g){var d=g;if("undefined"==typeof p.executingRoute&&(d=e),YUI.Env.isServer)return n(d),void 0;r.Flog.info(e,e.stack);try{if(r.config.win&&r.config.win.beaconError){e.panda=!0;var u=["undefined","Script error.","Script error","XHR error"];navigator.userAgent&&(void 0===typeof e.message||u.indexOf(e.message)>-1)&&(e.message=(e.message||"")+(navigator&&navigator.userAgent||"").toString()),r.config.win.beaconError("[flickr-router] _throwError failed: "+e.message,r.config.win.location.href,e),d!==e&&r.config.win.beaconError(d.message,r.config.win.location.href,d)}}catch(f){r.Flog.debug("Failed trying to beacon client error.")}}return o=p.executingRoute.display500Error(i,e),a=p.render(i,t,o)}},i={server:function(i,t,n){var o,a,s,c,p,l=!1,u="";if(t.headersSent)return r.Flog.debug("[flickr-router]","server render called but headers have already been sent",n&&n.view?"view="+n.view:null,"isBot="+(l?1:0),"timeout="+(i.timeout?1:0)),void 0;if(i&&i.UA&&(i.UA.isBot||i.UA.isSharingBot)&&(l=!0,u=r.fletrics.getBotString()),!n)throw new Error("No view config provide to serverside renderer.");return n.className="html-"+n.view,n.fluid&&(n.className+=" fluid"),n&&n.view&&-1!==["photo-page-scrappy-view","photo-page-lightbox-scrappy-view","search-groups-page-view","search-people-page-view","books-view","books-cover-view","books-spread-view","products-order-view","products-order-shipping-view","products-order-payment-view","products-order-complete-view","subscriptions-order-view","subscriptions-order-payment-view","subscriptions-order-complete-view","mobile-photo-page-view","sohp-view","cameraroll-page-view","cameraroll-comingsoon-page-view","photostream-page-view","albums-list-page-view","album-page-view","favorites-page-view","explore-page-view","groups-list-page-view","group-home-page-view","group-pool-page-view","group-discussions-list-page-view","group-discussion-page-view","group-members-page-view","shared-entity-page-view","person-groups-page-view","stats-view","stats-allphotos-view"].indexOf(n.view)&&(s="page."+n.view.replace(/\-/g,".")+".requests"+u,r.fletrics.increment(s)),n.headers&&n.headers.statusCode&&t.status(n.headers.statusCode),n.redirect?(t.redirect(n.redirect),void 0):n.json?(t.send(n.json),void 0):(a=i.appContext.modelImportExport.exportAll(),c=r.mix({langBundles:["misc"],appContext:i.appContext},r.Localizable),i.appContext&&(p=i.appContext.flipper.isFlipped("disable-client-app")),i.appContext.flipper.prepareForExport(),o={viewName:n.view,viewParams:n.params,modelExport:a,modelRegistries:Object.keys(a),appContext:i.appContext,response:t,title:n.title,className:n.className,language:i.lang.toLowerCase(),layout:n.layout,isMobile:n.isMobile,darkLoader:n.darkLoader,siteName:c.intlMessage({intlName:"misc.DEFAULT_PAGE_TITLE"}),updatedDate:r.moment().toISOString(),clientAppErrorMessage:{oopsMsgTitle:c.intlMessage({intlName:"misc.OOPS"}),oopsMsgMain:c.intlMessage({intlName:"misc.LOADING_ERROR"}),oopsMsgFooter:c.intlMessage({intlName:"misc.REFRESH"})},disableClientApp:p},t.expose(i.appContext.auth,"window.auth"),t.expose(i.id,"window.reqId"),t.expose(i.lang,"window.YUI_config.lang"),t.on("finish",function(){var t,o,a,c={};YUI.Env.isServer&&YUI.Env.config.debug_request_timing&&i.latencyTimerStart&&i.latencyTimerRouteStart&&i.latencyTimerViewStart&&i.latencyTimerRenderStart&&(a={middleware:YUI.Env.server.diffHrtime(i.latencyTimerStart,i.latencyTimerRouteStart),route:YUI.Env.server.diffHrtime(i.latencyTimerRouteStart,i.latencyTimerViewStart),view:YUI.Env.server.diffHrtime(i.latencyTimerViewStart,i.latencyTimerRenderStart),render:YUI.Env.server.diffHrtime(i.latencyTimerRenderStart,e.hrtime())},c["1. Middleware"]=(1e9*a.middleware[0]+a.middleware[1])/1e6+" ms",c["2. Route"]=(1e9*a.route[0]+a.route[1])/1e6+" ms",c["3. View"]=(1e9*a.view[0]+a.view[1])/1e6+" ms",c["4. Render"]=(1e9*a.render[0]+a.render[1])/1e6+" ms",r.Flog.info("[timing]","[waterfall]","isBot="+(l?1:0),c)),i.latencyTimerStart&&(t=e.hrtime(i.latencyTimerStart),t&&(o=(1e9*t[0]+t[1])/1e6,r.Flog.debug("[res]","view="+n.view,"isBot="+(l?1:0),"latency="+o),n&&n.view&&-1!==["photo-page-scrappy-view","photo-page-lightbox-scrappy-view","mobile-photo-page-view","sohp-view","cameraroll-page-view","cameraroll-comingsoon-page-view","photostream-page-view","albums-list-page-view","album-page-view","favorites-page-view","explore-page-view","groups-list-page-view","group-home-page-view","group-pool-page-view","group-discussions-list-page-view","group-discussion-page-view","group-members-page-view","shared-entity-page-view","person-groups-page-view","stats-view","stats-allphotos-view"].indexOf(n.view)&&(s="page."+n.view.replace(/\-/g,".")+".latency"+u,r.fletrics.set(s,o))))}),new r.Promise(function(e,i){t.emit("render"),t.render(n.view,o,function(o,a){o?(r.Flog.fatal("Client render had an error with the view:",n.view,o.message,o.stack),i(o)):(t.send(a),e(a))})}))},client:function(e,i,t){var n,o=this;return t.redirect?(window.location=t.redirect,r.Promise.resolve()):(document.title=t.title,r.loaderBar.progress(),e.appContext.getView(t.view,t.params,t.layout).then(function(i){return r.loaderBar.progress(),n=i,n._params&&(n._params.keyEventScope=n.name+n._yuid),e.appContext.getKeyboardManager().setCurrentKeyEventScope(n.name+n._yuid),n.set("isRootView",!0),n.initialize()}).then(function(){var i,a;r.loaderBar.progress(),i=r.one("html"),a=i.get("className").trim(),a=a.replace(/html-[\S]+-view/,"html-"+t.view),a=a.replace(/[\S]+-layout/,t.layout+"-layout"),a=a.replace("fluid",""),a+=t.fluid?" fluid":"",i.set("className",a),e.transactionId===o.currentTransactionId&&(o.app.showView(n,null,{render:!0,callback:function(){r.loaderBar.finish(),"popstate"!==e.src&&window.scroll(0,0)}}),!YUI.Env.isServer&&r.Flog&&r.Flog.timeEnd("[Routing to Activation]"))}).then(null,function(e){throw r.Flog.fatal("Client render had an error:",e.message,e.stack),e}))}},t={checkAndKick:function(e,r,i,t){return YUI.Env.isServer?(YUI.Env.server.bucketOptOut.checkAndKick(e,r,i,t),void 0):(i(),void 0)},checkAndInterstitial:function(e,r,i){var t;return YUI.Env.isServer&&e.appContext.flipper.isFlipped("browser-upgrade-interstitial")&&e&&e.headers&&(t=e.get("referer")?e.get("referer"):"",e.UA.isReallyUnsupportedBrowser&&!e.UA.isBot&&!e.UA.isSharingBot&&-1===e.url.indexOf("/browser/upgrade/")&&-1===t.indexOf("/browser/upgrade/"))?r.redirect("/browser/upgrade/?continue="+encodeURIComponent(e.url)):(i(),void 0)},bounceRoute:function(e,i,t,n,o){var a;return!YUI.Env.isServer||!YUI.Env.onManhattan||-1!==["gin.flickr.com","gin-flickr.com","staging.gin.flickr.com","staging-gin.flickr.com","smoke.gin.flickr.com","smoke-gin.flickr.com","dev.gin.flickr.com","dev-gin.flickr.com","dev2.gin.flickr.com","dev2-gin.flickr.com","perf.gin.flickr.com","perf-gin.flickr.com","perf2.gin.flickr.com","perf2-gin.flickr.com","perf3.gin.flickr.com","perf3-gin.flickr.com","spike.gin.flickr.com","spike-gin.flickr.com","qa.gin.flickr.com","qa-gin.flickr.com"].indexOf(e.headers.host)||/user-[a-z]+.dev.gin.flickr.com/i.test(e.headers.host)||/[a-z0-9]+.dev.gin.flickr.com/i.test(e.headers.host)||"undefined"!=typeof n.optin||"undefined"!=typeof n.public&&n.public?(t(),void 0):(r.Flog.error("[opt-in] no opt-in specified for "+n.module+" but we are not on gin.flickr.com or dev.gin.flickr.com, showing error page..."),a={view:"error-500-page-view",params:{},layout:"maximized"},(r.config.flickr.error.show_debugging_info||e.isInsecureGod)&&(a.params.source="flickrRouter#bounceRoute",a.params.message="[opt-in] no opt-in specified for "+n.module+" but we are not on gin.flickr.com or dev.gin.flickr.com, showing error page..."),e.id&&(a.params.requestID=r.moment().format("YYYY-MM-DD")+"-"+e.id),o.render(e,i,a))},checkOptIn:function(e,i,t,n){var o,a;return!YUI.Env.isServer||!n.optin||e.optins&&0!==e.optins.length&&-1!==e.optins.indexOf(n.optin)?(t(),void 0):(r.Flog.error("[opt-in] "+n.optin+" required for "+n.module+" but user has not opt-ed in to it, bouncing..."),o="https://"+e.headers.host+e.originalUrl,a=r.url(YUI.Env.config.optin.redirect_url+"?redirect_url="+encodeURIComponent(o)),YUI.Env.onManhattan||(a+="&dev=1"),i.redirect(a),void 0)},mixInServerRequest:function(e,i,t){YUI.Env.isServer||r.mix(e,r.namespace("config.flickr.request")),t()}}},"0.0.1",{requires:["fletrics","flog","oop","page-title-helper","moment","flickr-route","localizable","url","mobile-redirect","normalize-params-hash","normalize-param","normalize-path-params","set-route-config"],langBundles:["misc"]})}).call(this,e("_process"))},{_process:2}],2:[function(e,r){function i(){p=!1,a.length?c=a.concat(c):l=-1,c.length&&t()}function t(){if(!p){var e=setTimeout(i);p=!0;for(var r=c.length;r;){for(a=c,c=[];++l<r;)a&&a[l].run();l=-1,r=c.length}a=null,p=!1,clearTimeout(e)}}function n(e,r){this.fun=e,this.array=r}function o(){}var a,s=r.exports={},c=[],p=!1,l=-1;s.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)r[i-1]=arguments[i];c.push(new n(e,r)),1!==c.length||p||setTimeout(t,0)},n.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}]},{},[1]);